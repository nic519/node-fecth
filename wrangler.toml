# Cloudflare Workers 全栈配置
name = "node-fetch"
main = "src/index.ts"
compatibility_date = "2025-02-14"
compatibility_flags = ["nodejs_compat"]

# 静态资源配置 (Workers Static Assets)
[assets]
directory = "public"
binding = "ASSETS"
not_found_handling = "single-page-application"

# D1 数据库绑定
[[d1_databases]]
binding = "DB"
database_name = "node-fetch-db"
database_id = "7b3a5b77-a944-42e8-a822-614840ff97f9"

# KV 绑定（将逐步迁移到 D1）
[[kv_namespaces]]
binding = "KV_BINDING"
id = "52fa82d5a9c3438195385f592be41ef9"

[[kv_namespaces]]
binding = "USERS_KV"
id = "52fa82d5a9c3438195385f592be41ef9"

[observability.logs]
enabled = true

# 环境变量（非敏感信息）
[vars]
DB_USER = "{}"


# 敏感信息（如 SUPER_ADMIN_TOKEN）请使用 Secret：
# 设置方法：wrangler secret put SUPER_ADMIN_TOKEN
# 或在 Dashboard: Settings → Variables → Secrets

# 开发模式配置
[dev]
port = 8787
local_protocol = "http"
# 指定持久化目录，确保数据库文件位置固定
persist_to = "./.wrangler"

# 启用 workers.dev 子域名 (用于生产部署)
workers_dev = true 