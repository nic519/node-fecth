{
  "openapi": "3.1.0",
  "info": {
    "title": "Node-Fetch API",
    "version": "1.0.0",
    "description": "订阅管理和用户配置 API - 自动生成文档\n\n## 功能特性\n- �� 用户配置管理\n- 📊 流量统计\n- 🔄 订阅转换\n- 👥 用户管理（管理员功能）\n- 🗄️ KV 存储服务\n\n## 认证说明\n大部分 API 需要通过 `token` 查询参数进行认证。管理员接口需要 `superToken` 参数。\n\n## 生成时间\n2025-07-17T17:16:46.056Z\n\n## 已注册模块\n- Health\n- User\n- Admin\n- Storage\n- Subscription"
  },
  "servers": [
    {
      "url": "http://localhost:3000/api",
      "description": "开发服务器"
    }
  ],
  "components": {
    "schemas": {},
    "parameters": {}
  },
  "paths": {
    "/health": {
      "get": {
        "summary": "健康检查",
        "description": "检查服务状态",
        "tags": [
          "系统"
        ],
        "responses": {
          "200": {
            "description": "服务正常",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "number",
                      "enum": [
                        0
                      ]
                    },
                    "msg": {
                      "type": "string"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "status": {
                          "type": "string",
                          "description": "服务状态"
                        },
                        "timestamp": {
                          "type": "string",
                          "description": "检查时间"
                        }
                      },
                      "required": [
                        "status",
                        "timestamp"
                      ]
                    }
                  },
                  "required": [
                    "code",
                    "msg",
                    "data"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/config/user/update/{uid}": {
      "post": {
        "summary": "更新用户配置",
        "description": "更新指定用户的配置信息",
        "tags": [
          "用户配置"
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "description": "用户唯一标识符"
            },
            "required": true,
            "description": "用户唯一标识符",
            "name": "uid",
            "in": "path"
          },
          {
            "schema": {
              "type": "string",
              "description": "用户访问令牌"
            },
            "required": true,
            "description": "用户访问令牌",
            "name": "token",
            "in": "query"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "config": {
                    "type": "object",
                    "properties": {
                      "subscribe": {
                        "type": "string",
                        "format": "uri"
                      },
                      "accessToken": {
                        "type": "string",
                        "minLength": 1
                      },
                      "ruleUrl": {
                        "type": "string",
                        "format": "uri"
                      },
                      "fileName": {
                        "type": "string"
                      },
                      "multiPortMode": {
                        "type": "array",
                        "items": {
                          "type": "string",
                          "enum": [
                            "TW",
                            "SG",
                            "JP",
                            "VN",
                            "HK",
                            "US"
                          ]
                        }
                      },
                      "appendSubList": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "subscribe": {
                              "type": "string",
                              "format": "uri"
                            },
                            "flag": {
                              "type": "string",
                              "minLength": 1
                            },
                            "includeArea": {
                              "type": "array",
                              "items": {
                                "type": "string",
                                "enum": [
                                  "TW",
                                  "SG",
                                  "JP",
                                  "VN",
                                  "HK",
                                  "US"
                                ]
                              }
                            }
                          },
                          "required": [
                            "subscribe",
                            "flag"
                          ]
                        }
                      },
                      "excludeRegex": {
                        "type": "string"
                      }
                    },
                    "required": [
                      "subscribe",
                      "accessToken"
                    ]
                  }
                },
                "required": [
                  "config"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "更新成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "number",
                      "enum": [
                        0
                      ]
                    },
                    "msg": {
                      "type": "string"
                    },
                    "data": {}
                  },
                  "required": [
                    "code",
                    "msg"
                  ]
                }
              }
            }
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "number",
                      "minimum": 400
                    },
                    "msg": {
                      "type": "string"
                    },
                    "data": {}
                  },
                  "required": [
                    "code",
                    "msg"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "未授权访问",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "number",
                      "minimum": 400
                    },
                    "msg": {
                      "type": "string"
                    },
                    "data": {}
                  },
                  "required": [
                    "code",
                    "msg"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/config/user/detail/{uid}": {
      "get": {
        "summary": "用户详情",
        "description": "获取指定用户的详细信息",
        "tags": [
          "用户配置"
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "description": "用户唯一标识符"
            },
            "required": true,
            "description": "用户唯一标识符",
            "name": "uid",
            "in": "path"
          },
          {
            "schema": {
              "type": "string",
              "description": "用户访问令牌"
            },
            "required": true,
            "description": "用户访问令牌",
            "name": "token",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "用户详情",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "number",
                      "enum": [
                        0
                      ]
                    },
                    "msg": {
                      "type": "string"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "config": {
                          "type": "object",
                          "properties": {
                            "subscribe": {
                              "type": "string",
                              "format": "uri"
                            },
                            "accessToken": {
                              "type": "string",
                              "minLength": 1
                            },
                            "ruleUrl": {
                              "type": "string",
                              "format": "uri"
                            },
                            "fileName": {
                              "type": "string"
                            },
                            "multiPortMode": {
                              "type": "array",
                              "items": {
                                "type": "string",
                                "enum": [
                                  "TW",
                                  "SG",
                                  "JP",
                                  "VN",
                                  "HK",
                                  "US"
                                ]
                              }
                            },
                            "appendSubList": {
                              "type": "array",
                              "items": {
                                "type": "object",
                                "properties": {
                                  "subscribe": {
                                    "type": "string",
                                    "format": "uri"
                                  },
                                  "flag": {
                                    "type": "string",
                                    "minLength": 1
                                  },
                                  "includeArea": {
                                    "type": "array",
                                    "items": {
                                      "type": "string",
                                      "enum": [
                                        "TW",
                                        "SG",
                                        "JP",
                                        "VN",
                                        "HK",
                                        "US"
                                      ]
                                    }
                                  }
                                },
                                "required": [
                                  "subscribe",
                                  "flag"
                                ]
                              }
                            },
                            "excludeRegex": {
                              "type": "string"
                            }
                          },
                          "required": [
                            "subscribe",
                            "accessToken"
                          ]
                        },
                        "meta": {
                          "type": "object",
                          "properties": {
                            "lastModified": {
                              "type": "string"
                            },
                            "source": {
                              "type": "string",
                              "enum": [
                                "kv",
                                "env"
                              ]
                            },
                            "uid": {
                              "type": "string"
                            }
                          },
                          "required": [
                            "lastModified",
                            "source",
                            "uid"
                          ]
                        }
                      },
                      "required": [
                        "config",
                        "meta"
                      ]
                    }
                  },
                  "required": [
                    "code",
                    "msg",
                    "data"
                  ]
                }
              }
            }
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "number",
                      "minimum": 400
                    },
                    "msg": {
                      "type": "string"
                    },
                    "data": {}
                  },
                  "required": [
                    "code",
                    "msg"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "未授权访问",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "number",
                      "minimum": 400
                    },
                    "msg": {
                      "type": "string"
                    },
                    "data": {}
                  },
                  "required": [
                    "code",
                    "msg"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/admin/user/delete/{uid}": {
      "get": {
        "summary": "管理员删除用户",
        "description": "管理员删除指定用户及其所有数据",
        "tags": [
          "管理员"
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "description": "用户唯一标识符"
            },
            "required": true,
            "description": "用户唯一标识符",
            "name": "uid",
            "in": "path"
          },
          {
            "schema": {
              "type": "string",
              "description": "超级管理员访问令牌"
            },
            "required": true,
            "description": "超级管理员访问令牌",
            "name": "superToken",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "删除成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "number",
                      "enum": [
                        0
                      ]
                    },
                    "msg": {
                      "type": "string"
                    },
                    "data": {}
                  },
                  "required": [
                    "code",
                    "msg"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "未授权访问",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "number",
                      "minimum": 400
                    },
                    "msg": {
                      "type": "string"
                    },
                    "data": {}
                  },
                  "required": [
                    "code",
                    "msg"
                  ]
                }
              }
            }
          },
          "404": {
            "description": "用户不存在",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "number",
                      "minimum": 400
                    },
                    "msg": {
                      "type": "string"
                    },
                    "data": {}
                  },
                  "required": [
                    "code",
                    "msg"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/admin/user/create": {
      "post": {
        "summary": "创建新用户",
        "description": "创建新用户配置（需要管理员权限）",
        "tags": [
          "管理员"
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "uid": {
                    "type": "string",
                    "minLength": 1
                  },
                  "config": {
                    "type": "object",
                    "properties": {
                      "subscribe": {
                        "type": "string",
                        "format": "uri"
                      },
                      "accessToken": {
                        "type": "string",
                        "minLength": 1
                      },
                      "ruleUrl": {
                        "type": "string",
                        "format": "uri"
                      },
                      "fileName": {
                        "type": "string"
                      },
                      "multiPortMode": {
                        "type": "array",
                        "items": {
                          "type": "string",
                          "enum": [
                            "TW",
                            "SG",
                            "JP",
                            "VN",
                            "HK",
                            "US"
                          ]
                        }
                      },
                      "appendSubList": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "subscribe": {
                              "type": "string",
                              "format": "uri"
                            },
                            "flag": {
                              "type": "string",
                              "minLength": 1
                            },
                            "includeArea": {
                              "type": "array",
                              "items": {
                                "type": "string",
                                "enum": [
                                  "TW",
                                  "SG",
                                  "JP",
                                  "VN",
                                  "HK",
                                  "US"
                                ]
                              }
                            }
                          },
                          "required": [
                            "subscribe",
                            "flag"
                          ]
                        }
                      },
                      "excludeRegex": {
                        "type": "string"
                      }
                    },
                    "required": [
                      "subscribe",
                      "accessToken"
                    ]
                  }
                },
                "required": [
                  "uid",
                  "config"
                ]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "用户创建成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "number",
                      "enum": [
                        0
                      ]
                    },
                    "msg": {
                      "type": "string"
                    },
                    "data": {}
                  },
                  "required": [
                    "code",
                    "msg"
                  ]
                }
              }
            }
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "number",
                      "minimum": 400
                    },
                    "msg": {
                      "type": "string"
                    },
                    "data": {}
                  },
                  "required": [
                    "code",
                    "msg"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "未授权访问",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "number",
                      "minimum": 400
                    },
                    "msg": {
                      "type": "string"
                    },
                    "data": {}
                  },
                  "required": [
                    "code",
                    "msg"
                  ]
                }
              }
            }
          },
          "409": {
            "description": "用户已存在",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "number",
                      "minimum": 400
                    },
                    "msg": {
                      "type": "string"
                    },
                    "data": {}
                  },
                  "required": [
                    "code",
                    "msg"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/admin/user/all": {
      "get": {
        "summary": "获取所有用户列表",
        "description": "获取系统中所有用户的摘要信息（需要管理员权限）",
        "tags": [
          "管理员"
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "description": "超级管理员访问令牌"
            },
            "required": true,
            "description": "超级管理员访问令牌",
            "name": "superToken",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "用户列表",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "number",
                      "enum": [
                        0
                      ]
                    },
                    "msg": {
                      "type": "string"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "users": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "uid": {
                                "type": "string"
                              },
                              "token": {
                                "type": "string"
                              },
                              "hasConfig": {
                                "type": "boolean"
                              },
                              "source": {
                                "type": "string",
                                "enum": [
                                  "kv",
                                  "env",
                                  "none"
                                ]
                              },
                              "lastModified": {
                                "type": [
                                  "string",
                                  "null"
                                ]
                              },
                              "isActive": {
                                "type": "boolean"
                              },
                              "subscribeUrl": {
                                "type": "string"
                              },
                              "status": {
                                "type": "string",
                                "enum": [
                                  "active",
                                  "inactive",
                                  "disabled"
                                ]
                              },
                              "trafficInfo": {
                                "type": "object",
                                "properties": {
                                  "upload": {
                                    "type": "number"
                                  },
                                  "download": {
                                    "type": "number"
                                  },
                                  "total": {
                                    "type": "number"
                                  },
                                  "used": {
                                    "type": "number"
                                  },
                                  "remaining": {
                                    "type": "number"
                                  },
                                  "expire": {
                                    "type": "number"
                                  },
                                  "isExpired": {
                                    "type": "boolean"
                                  },
                                  "usagePercent": {
                                    "type": "number"
                                  }
                                },
                                "required": [
                                  "upload",
                                  "download",
                                  "total",
                                  "used",
                                  "remaining",
                                  "isExpired",
                                  "usagePercent"
                                ]
                              }
                            },
                            "required": [
                              "uid",
                              "token",
                              "hasConfig",
                              "source",
                              "lastModified",
                              "isActive",
                              "status"
                            ]
                          }
                        },
                        "count": {
                          "type": "number"
                        },
                        "timestamp": {
                          "type": "string"
                        }
                      },
                      "required": [
                        "users",
                        "count",
                        "timestamp"
                      ]
                    }
                  },
                  "required": [
                    "code",
                    "msg",
                    "data"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "未授权访问",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "number",
                      "minimum": 400
                    },
                    "msg": {
                      "type": "string"
                    },
                    "data": {}
                  },
                  "required": [
                    "code",
                    "msg"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/storage": {
      "get": {
        "summary": "存储内容获取操作",
        "description": "获取存储内容",
        "tags": [
          "存储"
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "description": "操作类型"
            },
            "required": false,
            "description": "操作类型",
            "name": "action",
            "in": "query"
          },
          {
            "schema": {
              "type": "string",
              "description": "存储键"
            },
            "required": false,
            "description": "存储键",
            "name": "key",
            "in": "query"
          },
          {
            "schema": {
              "type": "string",
              "description": "访问令牌"
            },
            "required": false,
            "description": "访问令牌",
            "name": "token",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "操作成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {}
                }
              },
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "number",
                      "minimum": 400
                    },
                    "msg": {
                      "type": "string"
                    },
                    "data": {}
                  },
                  "required": [
                    "code",
                    "msg"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "未授权访问",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "number",
                      "minimum": 400
                    },
                    "msg": {
                      "type": "string"
                    },
                    "data": {}
                  },
                  "required": [
                    "code",
                    "msg"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/kv": {
      "get": {
        "summary": "KV 存储操作",
        "description": "Key-Value 存储的获取和管理操作",
        "tags": [
          "KV存储"
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "description": "存储键"
            },
            "required": false,
            "description": "存储键",
            "name": "key",
            "in": "query"
          },
          {
            "schema": {
              "type": "string",
              "description": "命名空间"
            },
            "required": false,
            "description": "命名空间",
            "name": "namespace",
            "in": "query"
          },
          {
            "schema": {
              "type": "string",
              "description": "访问令牌"
            },
            "required": false,
            "description": "访问令牌",
            "name": "token",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "KV 操作成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "description": "存储的数据"
                    },
                    "key": {
                      "type": "string",
                      "description": "存储键"
                    },
                    "namespace": {
                      "type": "string",
                      "description": "命名空间"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "number",
                      "minimum": 400
                    },
                    "msg": {
                      "type": "string"
                    },
                    "data": {}
                  },
                  "required": [
                    "code",
                    "msg"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "未授权访问",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "number",
                      "minimum": 400
                    },
                    "msg": {
                      "type": "string"
                    },
                    "data": {}
                  },
                  "required": [
                    "code",
                    "msg"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/:uid": {
      "get": {
        "summary": "获取订阅配置",
        "description": "获取用户的 Clash 订阅配置",
        "tags": [
          "订阅"
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "description": "用户标识符"
            },
            "required": true,
            "description": "用户标识符",
            "name": "uid",
            "in": "path"
          },
          {
            "schema": {
              "type": "string",
              "description": "用户访问令牌"
            },
            "required": true,
            "description": "用户访问令牌",
            "name": "token",
            "in": "query"
          },
          {
            "schema": {
              "type": "string",
              "enum": [
                "clash",
                "v2ray",
                "ss"
              ],
              "description": "配置文件类型"
            },
            "required": false,
            "description": "配置文件类型",
            "name": "type",
            "in": "query"
          },
          {
            "schema": {
              "type": "boolean",
              "description": "是否启用UDP"
            },
            "required": false,
            "description": "是否启用UDP",
            "name": "udp",
            "in": "query"
          },
          {
            "schema": {
              "type": "boolean",
              "description": "是否作为下载文件"
            },
            "required": false,
            "description": "是否作为下载文件",
            "name": "download",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "Clash配置文件",
            "content": {
              "text/yaml": {
                "schema": {
                  "type": "string"
                }
              },
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {}
                }
              }
            }
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "number",
                      "minimum": 400
                    },
                    "msg": {
                      "type": "string"
                    },
                    "data": {}
                  },
                  "required": [
                    "code",
                    "msg"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "未授权访问",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "number",
                      "minimum": 400
                    },
                    "msg": {
                      "type": "string"
                    },
                    "data": {}
                  },
                  "required": [
                    "code",
                    "msg"
                  ]
                }
              }
            }
          }
        }
      }
    }
  },
  "webhooks": {}
}