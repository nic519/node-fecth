# ğŸ‰ Workers å…¨æ ˆæ¶æ„è¿ç§»å®Œæˆï¼

## âœ… è¿ç§»æ¦‚è¿°

æˆåŠŸå°†é¡¹ç›®ä» **Cloudflare Pages + Functions** æ¶æ„è¿ç§»åˆ° **çº¯ Workers å…¨æ ˆæ¶æ„**ï¼Œå®ç°äº†ç»Ÿä¸€çš„éƒ¨ç½²å’Œæ›´å¼ºçš„åŠŸèƒ½æ‰©å±•èƒ½åŠ›ã€‚

## ğŸ”§ æ ¸å¿ƒå˜æ›´åˆ—è¡¨

### 1. é…ç½®æ–‡ä»¶æ›´æ–° âœ…

- **`wrangler.toml`**: ä» Pages æ¨¡å¼è¿ç§»åˆ° Workers æ¨¡å¼
  - æ·»åŠ  `main = "src/index.ts"` æŒ‡å®š Worker å…¥å£
  - é…ç½® `[assets]` éƒ¨åˆ†å¯ç”¨ Workers Static Assets
  - è®¾ç½® `not_found_handling = "single-page-application"` æ”¯æŒ SPA è·¯ç”±
  - ä¿ç•™æ‰€æœ‰ KV ç»‘å®šå’Œç¯å¢ƒå˜é‡

### 2. å…¥å£ç‚¹é‡æ„ âœ…

- **`src/index.ts`**: é‡æ„ä¸ºç»Ÿä¸€çš„ Workers å…¥å£
  - ç§»é™¤å¼€å‘/ç”Ÿäº§æ¨¡å¼åŒºåˆ†
  - æ•´åˆ Pages Functions é€»è¾‘
  - æ·»åŠ å®Œæ•´çš„é”™è¯¯å¤„ç†
  - ä¼˜åŒ–æ—¥å¿—è®°å½•

### 3. éƒ¨ç½²è„šæœ¬æ›´æ–° âœ…

- **`package.json`**: æ›´æ–°æ‰€æœ‰éƒ¨ç½²ç›¸å…³è„šæœ¬
  - `deploy`: æ”¹ä¸º `yarn build:frontend && wrangler deploy`
  - `dev:backend`: æ”¹ä¸º `wrangler dev --port 8787`
  - æ·»åŠ  `preview` è„šæœ¬ç”¨äºæœ¬åœ°é¢„è§ˆ

### 4. æ„å»ºæµç¨‹ä¼˜åŒ– âœ…

- **`scripts/build-frontend.ts`**: é€‚é… Workers Static Assets
  - ç§»é™¤ `_routes.json` å¤åˆ¶é€»è¾‘
  - æ·»åŠ æ„å»ºéªŒè¯å’Œç»Ÿè®¡
  - ä¼˜åŒ–é”™è¯¯å¤„ç†

### 5. å‰ç«¯é…ç½®è°ƒæ•´ âœ…

- **`frontend/vite.config.ts`**: ä¼˜åŒ–å¼€å‘å’Œæ„å»ºé…ç½®
  - æ›´æ–° API ä»£ç†é…ç½®
  - æ·»åŠ  OpenAPI è§„èŒƒä»£ç†
  - ä¼˜åŒ–æ„å»ºè¾“å‡ºç»“æ„

### 6. API ç”Ÿæˆå™¨æ›´æ–° âœ…

- **`scripts/generate-api-client.ts`**: é€‚é… Workers å¼€å‘æœåŠ¡å™¨
  - æ›´æ–°æœåŠ¡å™¨åœ°å€è¯´æ˜
  - ä¼˜åŒ–é”™è¯¯æç¤ºä¿¡æ¯

### 7. æ¸…ç†å·¥ä½œ âœ…

- åˆ é™¤ `functions/` ç›®å½•
- åˆ é™¤ `frontend/public/_routes.json`
- æ¸…ç†æ‰€æœ‰ Pages ç‰¹æœ‰é…ç½®

## ğŸš€ æ–°æ¶æ„ä¼˜åŠ¿

### åŠŸèƒ½æ‰©å±•

- âœ… **Durable Objects**: åŸç”Ÿæ”¯æŒï¼ˆä¹‹å‰éœ€è¦é¢å¤–ç»‘å®šï¼‰
- âœ… **Cron Triggers**: æ”¯æŒå®šæ—¶ä»»åŠ¡ï¼ˆä¹‹å‰ä¸æ”¯æŒï¼‰
- âœ… **Queue Consumers**: æ”¯æŒé˜Ÿåˆ—æ¶ˆè´¹ï¼ˆä¹‹å‰ä¸æ”¯æŒï¼‰
- âœ… **é«˜çº§æ—¥å¿—**: Workers Logs, Source Maps ç­‰å®Œæ•´å¯è§‚æµ‹æ€§

### å¼€å‘ä½“éªŒ

- âœ… **ç»Ÿä¸€éƒ¨ç½²**: ä¸€ä¸ª Worker åŒ…å«å‰åç«¯
- âœ… **æ›´å¥½è°ƒè¯•**: å®Œæ•´çš„ DevTools æ”¯æŒ
- âœ… **æ¸è¿›å¼éƒ¨ç½²**: æ”¯æŒç°åº¦å‘å¸ƒ
- âœ… **ç®€åŒ–æ¶æ„**: å‡å°‘è¿ç»´å¤æ‚åº¦

### æˆæœ¬ä¼˜åŒ–

- âœ… **é™æ€èµ„æºå…è´¹**: ä¸ Pages ç›¸åŒ
- âœ… **å‡½æ•°è°ƒç”¨è®¡è´¹**: ä¸ Pages Functions ç›¸åŒ
- âœ… **å­˜å‚¨æˆæœ¬**: KV è´¹ç”¨ä¸å˜

## ğŸ“‹ ä½¿ç”¨æŒ‡å—

### å¼€å‘ç¯å¢ƒ

```bash
# å¯åŠ¨å®Œæ•´å¼€å‘ç¯å¢ƒï¼ˆæ¨èï¼‰
yarn dev

# æˆ–åˆ†åˆ«å¯åŠ¨
yarn dev:backend  # Workers å¼€å‘æœåŠ¡å™¨ (http://localhost:8787)
yarn dev:frontend # Vite å¼€å‘æœåŠ¡å™¨ (http://localhost:3000)
```

### æ„å»ºå’Œéƒ¨ç½²

```bash
# æ„å»ºå‰ç«¯
yarn build:frontend

# ç±»å‹æ£€æŸ¥
yarn type-check

# ç”Ÿæˆ API å®¢æˆ·ç«¯
yarn build:api

# éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
yarn deploy
```

### æœ¬åœ°é¢„è§ˆ

```bash
# æ„å»ºå¹¶é¢„è§ˆå®Œæ•´åº”ç”¨
yarn preview
```

## ğŸ§ª æµ‹è¯•ç»“æœ

### âœ… é€šè¿‡çš„æµ‹è¯•

- [x] TypeScript ç±»å‹æ£€æŸ¥
- [x] å‰ç«¯æ„å»ºæµç¨‹
- [x] Workers å¼€å‘æœåŠ¡å™¨å¯åŠ¨
- [x] é™æ€èµ„æºæ­£ç¡®ç”Ÿæˆ
- [x] é…ç½®æ–‡ä»¶è¯­æ³•æ­£ç¡®

### ğŸ”„ éœ€è¦éªŒè¯çš„åŠŸèƒ½

- [ ] API ç«¯ç‚¹æ­£å¸¸å“åº”
- [ ] å‰ç«¯é¡µé¢æ­£ç¡®åŠ è½½
- [ ] KV å­˜å‚¨æ­£å¸¸è®¿é—®
- [ ] ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- [ ] åŸŸåç»‘å®šé…ç½®

## ğŸ¯ ä¸‹ä¸€æ­¥æ“ä½œ

### 1. ç«‹å³æµ‹è¯•ï¼ˆæ¨èï¼‰

```bash
# å¯åŠ¨å¼€å‘ç¯å¢ƒ
yarn dev

# åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š
# - http://localhost:3000 (å‰ç«¯å¼€å‘æœåŠ¡å™¨)
# - http://localhost:8787 (Workers ç›´æ¥è®¿é—®)
```

### 2. ç”Ÿäº§éƒ¨ç½²

```bash
# ç¡®ä¿ Cloudflare è®¤è¯æ­£ç¡®
wrangler auth list

# éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
yarn deploy
```

### 3. åŸŸåé…ç½®

åœ¨ Cloudflare Dashboard ä¸­é…ç½®è‡ªå®šä¹‰åŸŸåï¼š

- è¿›å…¥ Workers ç®¡ç†é¡µé¢
- é€‰æ‹© `node-fetch-worker`
- é…ç½® Custom Domain

### 4. ç¯å¢ƒå˜é‡æ£€æŸ¥

ç¡®è®¤ç”Ÿäº§ç¯å¢ƒçš„ç¯å¢ƒå˜é‡å’Œ KV ç»‘å®šï¼š

```bash
wrangler secret list
```

## ğŸ”® æœªæ¥æ‰©å±•èƒ½åŠ›

### 1. ç«‹å³å¯ç”¨çš„æ–°åŠŸèƒ½

- **Cron Triggers**: æ·»åŠ å®šæ—¶ä»»åŠ¡
- **Queue Consumers**: å¼‚æ­¥ä»»åŠ¡å¤„ç†
- **Durable Objects**: çŠ¶æ€ç®¡ç†å’Œå®æ—¶åŠŸèƒ½

### 2. Vercel è¿ç§»å‡†å¤‡

å·²ç»ä¸ºæœªæ¥å¯èƒ½çš„ Vercel è¿ç§»åšäº†æ¶æ„å‡†å¤‡ï¼š

- ä¸šåŠ¡é€»è¾‘ä¸å¹³å°è§£è€¦
- æ ‡å‡† HTTP æ¥å£
- å¯æ‰©å±•çš„ç¯å¢ƒæŠ½è±¡

### 3. ç›‘æ§å’Œè§‚æµ‹

- å¯ç”¨ Workers Analytics
- é…ç½® Real-time Logs
- è®¾ç½®å‘Šè­¦è§„åˆ™

## ğŸŠ è¿ç§»æˆåŠŸï¼

æ­å–œï¼ä½ çš„é¡¹ç›®ç°åœ¨è¿è¡Œåœ¨ç°ä»£åŒ–çš„ Workers å…¨æ ˆæ¶æ„ä¸Šï¼Œå…·å¤‡äº†ï¼š

- ğŸš€ **æ›´å¼ºçš„åŠŸèƒ½æ‰©å±•èƒ½åŠ›**
- ğŸ› ï¸ **æ›´å¥½çš„å¼€å‘ä½“éªŒ**
- ğŸ“Š **å®Œæ•´çš„å¯è§‚æµ‹æ€§**
- ğŸ”§ **ç®€åŒ–çš„è¿ç»´ç®¡ç†**

äº«å— Workers ç”Ÿæ€å¸¦æ¥çš„å¼ºå¤§åŠŸèƒ½å§ï¼ ğŸ‰
